package com.concepts.redis;

import java.util.Map;
import java.util.UUID;

import org.junit.Test;
import org.junit.runner.RunWith;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;
import org.springframework.boot.web.server.LocalServerPort;
import org.springframework.http.HttpStatus;
import org.springframework.test.context.junit4.SpringRunner;

import com.jayway.restassured.RestAssured;
import com.jayway.restassured.http.ContentType;
import com.jayway.restassured.path.json.JsonPath;
import com.jayway.restassured.path.json.config.JsonPathConfig;
import com.jayway.restassured.response.Response;
import com.jayway.restassured.response.ResponseBody;

@RunWith(SpringRunner.class)
@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)
public class RedisApplicationTests {

	@LocalServerPort
	private int port;

	@Test
	public void contextLoads() {
	}

	@Test
	public void testRestAssured() {
		RestAssured.given().auth().preemptive().basic("user1", UUID.randomUUID().toString()).and()
				.accept(ContentType.JSON).when().get("https://www.google.co.in/").then()
				.statusCode(HttpStatus.OK.value());
	}

	@Test
	public void testThinkingSortedSets() {
		Response response = RestAssured.given().accept(ContentType.JSON).when()
				.get("http://localhost:" + port + "/playSortedSets").thenReturn();
		assert (response.getStatusCode() == 200);
		JsonPath jsonPath = response.getBody().jsonPath(new JsonPathConfig());
		Map<Object, Object> map = jsonPath.getMap("data");
		assert ((Integer) map.get("Positive Score Element Count") == 3);
		jsonPath.prettyPrint();
	}
	
	@Test
	public void testPipelining() {
		Response response = RestAssured.given().accept(ContentType.JSON).when()
				.get("http://localhost:" + port + "/tryPipelining").thenReturn();
		assert (response.getStatusCode() == 200);
		ResponseBody body = response.getBody();
		assertTrue(response.getBody().asString().contains("11"));
		
		
	}
}
